<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>Physical Zoom Mute & Video Buttons</title>

  
  <meta name="author" content="© Tyler Bisk">
  

  

  <link rel="alternate" type="application/rss+xml" title="Tyler Bisk - A portfolio of my greatest projects and acheivements" href="http://localhost:4000/feed.xml">

  

  

  


  
    
      
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">


    
      
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css">


    
      
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic">


    
      
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800">


    
  

  
    
      <link rel="stylesheet" href="/assets/css/bootstrap-social.css">
       <link rel="shortcut icon" type="image/png" href="/assets/img/favico.png">
    
      <link rel="stylesheet" href="/assets/css/main.css">
       <link rel="shortcut icon" type="image/png" href="/assets/img/favico.png">
    
  

  

  

  <!-- Facebook OpenGraph tags -->
  

  
  <meta property="og:title" content="Physical Zoom Mute & Video Buttons">
  

   
  <meta property="og:description" content="## Introduction In this day and age where meetings are mostly digitally hosted on Zoom, all too often we find ourselves with our cameras and microphones unexpectedly off - or worse - unexpectedly on. The goal of our project is to bring ease and simplicity to zoom controls by adding...">
  


  <meta property="og:type" content="website">

  
  <meta property="og:url" content="http://localhost:4000/zoom_buttons">
  <link rel="canonical" href="http://localhost:4000/zoom_buttons">
  

  
  <meta property="og:image" content="https://i.imgur.com/aNniMuV.png">
  


  <!-- Twitter summary cards -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@tylerbisk">
  <meta name="twitter:creator" content="@tylerbisk">

  
  <meta name="twitter:title" content="Physical Zoom Mute & Video Buttons">
  

  
  <meta name="twitter:description" content="## Introduction In this day and age where meetings are mostly digitally hosted on Zoom, all too often we find ourselves with our cameras and microphones unexpectedly off - or worse - unexpectedly on. The goal of our project is to bring ease and simplicity to zoom controls by adding...">
  

  
  <meta name="twitter:image" content="https://i.imgur.com/aNniMuV.png">
  

  

  

</head>


  <body>

    


    <nav class="navbar navbar-expand-md navbar-light fixed-top navbar-custom "><a class="navbar-brand" href="/">Tyler Bisk</a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="main-navbar">
    <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link" href="/about">About Me</a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Cornell FSAE</a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                  <a class="dropdown-item" href="/fsae/about">about</a>
                  <a class="dropdown-item" href="/fsae/tsm">Temperature Sensing Module</a>
                  <a class="dropdown-item" href="/fsae/shutdown_box">Shutdown Box</a>
            </div>
          </li>
        
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Other Projects</a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                  <a class="dropdown-item" href="/sips">Sips for iOS</a>
                  <a class="dropdown-item" href="/freasy">Freasy for iOS</a>
                  <a class="dropdown-item" href="/zoom_buttons">Physical Zoom Buttons</a>
            </div>
          </li>
        
          <li class="nav-item">
            <a class="nav-link" href="/resume">Resume</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/contact">Contact Me</a>
          </li></ul>
  </div>

  

</nav>


    <!-- TODO this file has become a mess, refactor it -->







<header class="header-section ">

<div class="intro-header no-img">
  <div class="container-md">
    <div class="row">
      <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1">
        <div class="page-heading">
          <h1></h1>
      

      
        </div>
      </div>
    </div>
  </div>
</div>
</header>





<div class="container-md" role="main">
  <div class="row">
    <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1">
      <h2 id="introduction">Introduction</h2>
<p>In this day and age where meetings are mostly digitally hosted on Zoom, all too often we find ourselves with our cameras and microphones unexpectedly off - or worse - unexpectedly on.</p>

<p>The goal of our project is to bring ease and simplicity to zoom controls by adding physical zoom buttons - one for the camera and one for the microphone - alongside LEDs to represent the on/off state of each of the two devices.</p>

<h4 id="the-physical-product">The Physical Product</h4>
<p><img src="https://i.imgur.com/aNniMuV.png" alt="Button_Case" /></p>

<hr />

<h2 id="how-to-use">How to Use</h2>
<ol>
  <li>Run the following commands:
    <ul>
      <li><code class="highlighter-rouge">python3 -m pip install keyboard</code></li>
      <li><code class="highlighter-rouge">python3 -m pip install pyserial</code></li>
    </ul>
  </li>
  <li>Go to System Preferences, go to Security and Privacy, go to accessibility, enable Terminal</li>
  <li>In Zoom, go to Settings, go to Keyboard Shortcuts, Enable Global Shortcut for Mute/Unmute My Audio and Start/Stop Video</li>
  <li>Run <code class="highlighter-rouge">./zoom.sh</code> on your computer and plug in the FRDM-KL25Z board (we are assuming the board is already running our MCUXpresso project)</li>
</ol>

<p>YOU ARE ALL SET! Press the Mic button to Mute/Unmute and press the Camera button to Start/Stop Video.</p>

<hr />

<h2 id="video-demo">Video Demo</h2>

<iframe width="668" height="376" src="https://www.youtube.com/embed/c0DGW9YYTec" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>

<hr />

<h2 id="system-overview">System Overview</h2>
<h4 id="top-level-overview">Top-Level Overview</h4>
<p><img src="https://i.imgur.com/uL3yQ4N.png" alt="Top-Level" /></p>

<h4 id="hardware-schematic">Hardware Schematic</h4>
<p><img src="https://i.imgur.com/Fbe8uQn.png" alt="Schematic" /></p>

<p>As seen in the schematic, there are two physical buttons: a mic button and a camera button.  When a button is pressed, an interrupt is triggered corresponding to that button.  Both of the LEDs associated with that button will then toggle.  The idea is that in the initial state only the red LED is on.  Since the LEDs are always toggled in pairs, only one LED from each set will be illuminated at a given time.  A green LED means the device corresponding to that button is currently on, and a red LED signifies that it is off. The buttons send signals to the chip, and the chip then sends signals to the pins that the LEDs are soldered to.</p>

<p>The chip also sends a UART signal to the laptop it is plugged into.  That UART signal tells a python script whether to send the keyboard shortcut to toggle the microphone or to send the keyboard shortcut to toggle the camera.  An extension called PyKeyboard then controls the computer’s keyboard and sends out the keyboard shortcut.  Finally, Zoom registers the shortcut and applies the toggle.</p>

<p>Zoom can even be in the background when the physical button is pressed, as long as it is running and global keyboard shortcuts are enabled.</p>

<!--- ## Progress to Date
As of 5/18/21, we have done all of the hardware integration that we need (including LEDs) and also have written our python script.  We have tested each of these components individually.  Now all we have left is to integrate the two parts with UART and test the system as a whole.  Then, we can finish up the webpage and get cracking on the video.--->

<hr />

<h2 id="detailed-technical-description">Detailed Technical Description</h2>
<h4 id="buttons">Buttons</h4>
<p>Each of the two buttons is normally open with a pull-down resistor to ground.  The other terminal of the button is connected to the 3V3 pin of the board.  When the button is not pressed, PTA12 and PTD5 are both low.  These two pins are set to GPIO inputs and are configured to trigger interrupts on the rising edge of the signal.  So, when the button is pressed, the respective signal goes from 0 to 1 and triggers the corresponding interrupt.</p>

<h4 id="leds">LEDs</h4>
<p>There is one Red Led and one Green LED per button, making four LEDs total.  All four anodes are soldered and spliced together and are powered by the 3V3 pin on the board’s header.  Each of the cathodes is connected to a pin on the board that has been set to general-purpose output.  Then, the output can be set to one or cleared to zero.  When the output is low, the LED turns on because there is a voltage drop across the LED.  When the output is high, there is no potential difference and the LED is not illuminated.</p>

<h4 id="utilsc">utils.c</h4>
<p>The usual <code class="highlighter-rouge">utils.c</code> file that was provided for previous labs had to be completely rewritten.  Our plan was to not use the on-board LED whatsoever, so we made blank <code class="highlighter-rouge">utils.c</code> and <code class="highlighter-rouge">utils.h</code> files to restart from scratch.</p>

<p>In our new <code class="highlighter-rouge">LED_Initialize()</code>, we must first enable the clocks for ports B and C and enable the correct pins of those ports, PTC1, PTC2, PTB11, and PTB10, as GPIO.  Then, the pins must be given a data direction of output and the LEDs turned off.</p>

<p>We also added a <code class="highlighter-rouge">Analog_Pin_Initialize()</code> that gets the chip ready to receive signals from the buttons.  After enabling the clock for ports A and D, PTA12 (the microphone button) and PTD5 (the video button) are enabled as GPIO.  Additionally, these pins are set to trigger an interrupt on the rising edge of the signal.  The pins are then given data direction of input and finally, we must run <code class="highlighter-rouge">NVIC_EnableIRQ(PORTA_IRQn); NVIC_EnableIRQ(PORTA_IRQn);</code> which will give us different interrupt handlers when the different buttons are pressed so we can control their functions separately.</p>

<p>To set up and use UART, there are three functions included in our <code class="highlighter-rouge">utils.c</code> that were heavily inspired by Professor Napp’s sample code.  <code class="highlighter-rouge">UART_Initialize()</code> is run once just to set up some parameters and uses UART0 combined with PTA1 and PTA2 to function as RX and TX and then uses the USB as a serial port.  We also take advantage of a function called <code class="highlighter-rouge">UART_char(char c)</code> which sends a character <code class="highlighter-rouge">c</code> over serial to be read by the computer that the board is plugged into.</p>

<p>There are four functions in <code class="highlighter-rouge">utils.c</code> are used to toggle each of the four LEDs.  We do this by setting the corresponding pin of the correct Port Toggle Output Register to 1.  For example, for the Red Mic LED on PTC1, we would do <code class="highlighter-rouge">PTC-&gt;PTOR = 1 &lt;&lt; 1</code></p>

<p>The last function is the <code class="highlighter-rouge">delay(int t)</code> function. This function runs a while loop t times.</p>

<h4 id="mainc">main.c</h4>
<p>There are three functions in <code class="highlighter-rouge">main.c</code></p>

<p>In <code class="highlighter-rouge">main()</code> we initialize the LEDs, buttons, and UART0 with the following functions (<code class="highlighter-rouge">LED_Initialize()</code>, <code class="highlighter-rouge">Analog_Pin_Initialize()</code>, <code class="highlighter-rouge">UART_Initialize()</code>). We then turn the red LED on for both the camera and the microphone with the following functions (<code class="highlighter-rouge">MicRed_Toggle</code> and <code class="highlighter-rouge">CameraRed_Toggle</code>). We then set a forever loop so that our code can run forever with the buttons always staying active. Lastly we have a return statement, which is never run as the forever loop should never end.</p>

<p>The other two functions are interrupt handlers for Ports A and D.
<code class="highlighter-rouge">PORTA_IRQHandler()</code> is the interrupt handler for the camera and <code class="highlighter-rouge">PORTD_IRQHandler()</code> is for the mic. In these functions we disable interrupts, toggle both the red and green LEDs so that either red or green is on and the other is off and send the character 0 through UART0. We then call the <code class="highlighter-rouge">delay()</code> function to delay the interrupt handler response as we want to give time for the button to come back up. We then reset the interrupt status flag for either Port A or D. We then enable interrupts.</p>

<h4 id="zoomsh">zoom.sh</h4>
<p>The variable <code class="highlighter-rouge">usb</code> is set to the return of <code class="highlighter-rouge">ls /dev/tty.usbmodem*</code>, which is the name of the port the board is connected too. The script then prints that the Python Code is running. Lastly, the python code is run with a single argument passed in with the run which is <code class="highlighter-rouge">usb</code>.</p>

<h4 id="zoompy">zoom.py</h4>
<p>Four python libraries <code class="highlighter-rouge">sys</code>, <code class="highlighter-rouge">serial</code>, <code class="highlighter-rouge">struct</code>, <code class="highlighter-rouge">keyboard</code> are imported. The functionally of these libraries are described in the Resources section. The variable <code class="highlighter-rouge">ser</code> is set to the usb port passed to the python script from the bash script. In a forever loop the variable <code class="highlighter-rouge">command</code> is set to the data passed through the USB in ASCII. If <code class="highlighter-rouge">command</code> is equal to 0 the keys <em>command+shift+a</em> are pressed to mute or unmute, if <code class="highlighter-rouge">command</code> is equal to 1 the keys <em>command+shift+v</em> are pressed to turn the camera on or off.</p>

<h4 id="system-housing">System housing</h4>
<p>We built a wooden case for our zoom buttons. The are 3 sides of equal wood thickness and 1 side which is a little thicker. On the thicker side we have hot glued the 2 buttons. We then built a small platform on the top of the 4 sides to rest the FRDM-KL25Z board. We allowed for gaps between the platform and the walls to push the wires under the platform and create a cleaner design.</p>

<hr />

<h2 id="testing">Testing</h2>
<p>Since there are so many pieces of the project, we made sure to test each part individually before linking components together and ultimately testing the full system.</p>

<p>We tested to make sure our LEDs would turn on. We did this in many stages. First, before soldering the LEDS to the board, we tested which ports we had to use as power and ground for the LEDs. Once we looked at the board schematics and got the LEDs to light up we soldered them to the tested ports. We then wrote the code for LED initialize, and all the LED toggle functions. To test these functions in our <code class="highlighter-rouge">main.c</code> we ran <code class="highlighter-rouge">LED_Initialize</code>, then toggled all the lights, then waited for a second, and ran <code class="highlighter-rouge">LED_Off</code>. All the functions worked as expected.</p>

<p>We tested that the buttons would trigger interrupts by turning on LEDs. When first coding the buttons we started with the <code class="highlighter-rouge">Analog_Pin_Initialize</code> function. After in <code class="highlighter-rouge">main.c</code> we wrote a test case to test the button interrupts. We wrote two interrupt handler functions, one for Port A and one for Port D. In these functions we toggled the red and green LED’s, this way if green was on it would turn off and if red was off it would turn on, and so on. In the main functions we called <code class="highlighter-rouge">LED_Initialize</code>, <code class="highlighter-rouge">Analog_Pin_Initialize</code>, and toggled both red LED’s (<code class="highlighter-rouge">MicRed_Toggle</code> and <code class="highlighter-rouge">CameraRed_Toggle</code>). When we ran this code the Port D interrupt would not work. This was because we forgot to set the clock for Port D. Once we fixed this in <code class="highlighter-rouge">Analog_Pin_Initialize</code> our test case worked.</p>

<p>Off-board, we tested how to work with the keyboard python library. We had many issues when testing this component because of the security measures in OS systems. When first working with the library we tested if we could get the python program to press the ‘a’ key. While debugging this test we found out that we need to enable terminal access in Security and Privacy settings. After we successfully got the python code to press the ‘a’ key, we moved on to testing the keys ‘command+shift+a’ as these are the keys needed to mute on zoom. Unfortunately, this didn’t work right away either as there was another setting that we had to set in Zoom, we made keyboard commands global, meaning you could use keyboard commands even if you were not clicked on the Zoom application. After setting this our test worked.</p>

<p>Lastly, we tested the UART functionality. We used the code given to us by Professor Napp so luckily all the UART code worked in our first test. For this first test we called <code class="highlighter-rouge">UART_Initialize</code> in <code class="highlighter-rouge">main.c</code> and then we called <code class="highlighter-rouge">UART_char</code> in each of our interrupt handlers. Then in <code class="highlighter-rouge">zoom.py</code> we used the code provided to use by Professor Napp again to get the character we sent through UART.</p>

<p>After combining all the above test cases we got the final <code class="highlighter-rouge">main.c</code> for our project.</p>

<hr />

<h2 id="resources">Resources</h2>
<p>We took advantage of some of the default serial code that was provided by Professor Napp.
We also used the following Python libraries:</p>
<ul>
  <li><a href="https://docs.python.org/3/library/sys.html">sys</a> to pass arguments with the python run command</li>
  <li><a href="https://pypi.org/project/pyserial/">serial</a> to get data from the USB port</li>
  <li><a href="https://docs.python.org/3/library/struct.html">struct</a> to decode the data from the USB port</li>
  <li><a href="https://pypi.org/project/keyboard/">keyboard</a> to use python to control the computer’s keyboard and send keyboard shortcuts</li>
</ul>

<hr />

<h2 id="work-distribution">Work Distribution</h2>
<p>The work distribution was very equal in terms of hours spent on the project. Luckily, both partners were in the Ithaca area for the duration of the project, so work was done in person. We worked on the project throughout four five-hour, in-person meetings. During in-person work sessions, Tyler spent time designing the circuit and soldering, splicing, and pinning wires, while Ashok worked to research and write code for how the board would ultimately communicate with Zoom, and worked to build a casing for the buttons. Both partners worked on main.c, utils.c, zoom.py, and zoom.sh equally.  The report and video were co-written and co-produced by Tyler and Ashok.</p>


      
    </div>
  </div>
</div>


    <footer>
  <div class="container-md beautiful-jekyll-footer">
    <div class="row">
      <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1">
      <ul class="list-inline text-center footer-links"><li class="list-inline-item">
    <a href="mailto:tyler07039@gmail.com" title="Email me">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">Email me</span>
   </a>
  </li><li class="list-inline-item">
    <a href="https://calendly.com/tylerbisk" title="Schedule a meeting with me">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fas fa-calendar-check fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">Schedule a meeting with me</span>
   </a>
  </li><li class="list-inline-item">
    <a href="https://github.com/tylerbisk" title="GitHub">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fab fa-github fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">GitHub</span>
   </a>
  </li><li class="list-inline-item">
    <a href="https://twitter.com/tylerbisk" title="Twitter">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">Twitter</span>
   </a>
  </li><li class="list-inline-item">
    <a href="https://linkedin.com/in/tylerbisk" title="LinkedIn">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">LinkedIn</span>
   </a>
  </li></ul>

      
      <p class="copyright text-muted">
      
        © Tyler Bisk
        &nbsp;&bull;&nbsp;
      
      2021

      

      
      </p>
      <!-- Add a second line to the footer -->
      <p class="theme-by text-muted">

      </p>
      </div>
    </div>
  </div>
</footer>


    
  
    
  <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>


  
    
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>


  
    
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>


  



  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
      <script src="/assets/js/main.js"></script>
    
  







  </body>
</html>

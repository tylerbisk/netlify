<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>RF & Navigation</title>

  
  <meta name="author" content="© Tyler Bisk">
  

  
  <meta name="description" content="Autonomous Maze Solving Robot Part 4 (Final)">
  

  <link rel="alternate" type="application/rss+xml" title="Tyler Bisk - A portfolio of my greatest projects and achievements" href="http://localhost:4000/feed.xml">

  

  

  


  
    
      
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">


    
      
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css">


    
      
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic">


    
      
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800">


    
  

  
    
      <link rel="stylesheet" href="/assets/css/bootstrap-social.css">
       <link rel="shortcut icon" type="image/png" href="/assets/img/favico.png">
    
      <link rel="stylesheet" href="/assets/css/main.css">
       <link rel="shortcut icon" type="image/png" href="/assets/img/favico.png">
    
  

  

  

  <!-- Facebook OpenGraph tags -->
  

  
  <meta property="og:title" content="RF & Navigation">
  

   
  <meta property="og:description" content="Autonomous Maze Solving Robot Part 4 (Final)">
  


  <meta property="og:type" content="website">

  
  <meta property="og:url" content="http://localhost:4000/3400/part4">
  <link rel="canonical" href="http://localhost:4000/3400/part4">
  

  


  <!-- Twitter summary cards -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@tylerbisk">
  <meta name="twitter:creator" content="@tylerbisk">

  
  <meta name="twitter:title" content="RF & Navigation">
  

  
  <meta name="twitter:description" content="Autonomous Maze Solving Robot Part 4 (Final)">
  

  

  

  

</head>


  <body>

    


    <nav class="navbar navbar-expand-md navbar-light fixed-top navbar-custom "><a class="navbar-brand" href="/">Tyler Bisk</a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="main-navbar">
    <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link" href="/about">About Me</a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Cornell FSAE</a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                  <a class="dropdown-item" href="/fsae/about">about</a>
                  <a class="dropdown-item" href="/fsae/tsm">Temperature Sensing Module (2020)</a>
                  <a class="dropdown-item" href="/fsae/shutdown_box">Shutdown Box (2021)</a>
                  <a class="dropdown-item" href="/fsae/electrical_lead">Electrical Lead (2022)</a>
            </div>
          </li>
        
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Software</a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                  <a class="dropdown-item" href="/sips">Sips</a>
                  <a class="dropdown-item" href="/freasy">Freasy</a>
            </div>
          </li>
        
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Micro-controllers</a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                  <a class="dropdown-item" href="/zoom_buttons">Physical Zoom Buttons</a>
                  <a class="dropdown-item" href="/3400/home">Autonomous Maze-Solving Robot</a>
                  <a class="dropdown-item" href="/ece4760/lab1">Bird Song Synthesizer</a>
                  <a class="dropdown-item" href="/ece4760/lab3">PID Motor Controller</a>
                  <a class="dropdown-item" href="/ece4760/final">PIC32 Video Game</a>
            </div>
          </li>
        
          <li class="nav-item">
            <a class="nav-link" href="/resume">Resume</a>
          </li></ul>
  </div>

  

</nav>


    <!-- TODO this file has become a mess, refactor it -->







<header class="header-section ">

<div class="intro-header no-img">
  <div class="container-md">
    <div class="row">
      <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1">
        <div class="page-heading">
          <h1>RF & Navigation</h1>
      
        
            <hr class="small">
            <span class="page-subheading">Autonomous Maze Solving Robot Part 4 (Final)</span>
      
      
      
      
        </div>
      </div>
    </div>
  </div>
</div>
</header>





<div class="container-md" role="main">
  <div class="row">
    <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1">
      <h3 id="objective">Objective</h3>
<ol>
  <li>Communicate information wirelessly over RF</li>
  <li>Navigate an unknown maze in order to discover treasures</li>
  <li>Enable robot when a specific note in a melody is heard</li>
</ol>

<h3 id="the-hardware">The Hardware</h3>
<p>By the beginning of part 4, the robot already had all the necessary hardware for navigating a maze, detecting treasures and walls, and generating an FFT using a microphone.  The base station already could output given <code class="language-plaintext highlighter-rouge">unsigned ints</code> (range of 0 - 65,535) to the 7-segment display.  Now, to tie the two together, we needed an RF transceiver to transmit and receive data between the two.  The transceiver is affixed to a PCB with soldered headers, as shown in Figure 1.</p>
<div align="center">
    <b>Figure 1: RF Transceiver and PCB</b>
    <br />
    <img src="/assets/img/3400/lab4_pcb.png" style="width: 54%" />
    <p></p>
</div>
<div align="right">
[1]
</div>

<p>The four pins on the nano being used that are directly connected when sticking the PCB into the breadboard are D9-D12 for SPI communication (CS, CE, MOSI and, MISO respectively).  Jumper wires are then used to connect the transceiver to the 3V3, ground, and SCK pins on the nano.  Now, when the process is repeated again on the base station, the nanos can transmit data wirelessly to one another.</p>

<div align="center">
    <b>Figure 2: The Completed Robot</b>
    <br />
    <img src="/assets/img/3400/lab4_robot1.jpeg" style="width: 64%" />
    <p></p>
</div>

<h3 id="the-fft">The FFT</h3>
<p>The first thing that needs to happen in the demo is the robot must begin moving  when it hears a 950 Hz tone.  It sits ans waits at the beginning of the maze until such a noise is heard.  We already had code from part 3 to generate an FFT, so using that code we generated a plot of a 950 Hz signal.</p>
<div align="center">
    <b>Figure 3: FFT of a 950 Hz Signal</b>
    <br />
    <img src="/assets/img/3400/lab4_fft.png" style="width: 60%" />
    <p></p>
</div>

<p>From visually inspecting the results, it is clear that bin 103 corresponds to 950 Hz, with not much frequency content outside of bins 102-104.  Therefore, in our final demo code, we generate an FFT and check to see if bin 103 is above a certain threshold.  If it is not, then throw away the results and take another FFT.  If it is, then we must <strong>completely disable</strong> the FFT code and its interrupts, then setup the servos, ultrasonic sensors, RF, and phototransistors.  Failing to do this crucial step results in sensor readings that are either way too high or too low and possibly servos that do not behave as expected.  We debugged this issue by commenting out lines of our FFT code until the sensors behaved as we expected, then restored registers to what they were after hearing a 950 Hz tone before proceeding with Navigation.</p>

<p>In the event that our robot does not hear the sound, we have an FFT Override button.  The button is a normally open button with a pull down resistor.  When the button is pressed, the signal goes high and we add another condition to our FFT start the robot statement that checks if <code class="language-plaintext highlighter-rouge">FFT_OVERRIDE_PIN</code> = 1. <code class="language-plaintext highlighter-rouge">FFT_OVERRIDE_PIN</code> can be any unused digital pin on the nano.</p>

<h3 id="the-navigation">The Navigation</h3>

<h4 id="pid">PID</h4>
<p>We spent the most time on navigation because there are a lot of moving parts (literally).  For our final demo, we used PID when moving forward to keep the robot in the center of the maze.  Lots of time was spent adjusting the values of PID that would consistently result in robot that could handle getting a few bad sensor readings in a row without crashing.  This was more difficult than it seems because if the robot makes too big of a correction then it will no longer be pointed perpendicularly to the wall and the sensor readings will get larger-than-expected values.  Then, the robot gets turned even further from the wall and ends up crashing in a positive feedback loop.  We were able to mitigate some of these errors by stopping for a second (non-blocking) if the sensor reads something that does not seem quite right.  Additionally, we put a cap on the maximum amount that the robot can turn at a time so it is never too far from perpendicular.</p>

<h4 id="turning">Turning</h4>
<p>An advantage our robot had over other robots is that we used the ultrasonic sensors to turn 90º instead of timing it out, which is highly dependent on servo calibration.  When we turn right, for example, after the robot has turned away for a few milliseconds we begin to sense for the left sensor to read a value determined by how far away the front sensor was from the wall when it began turning.  This implementation worked pretty well and the robot consistently turned about 90º.  It worked so well that Carl took a video of it in action.</p>

<h4 id="navigation-algorithm">Navigation Algorithm</h4>
<p>As described above, our robot could go straight and could turn left, right, and turn around.  The final piece of the puzzle was to design some sort of algorithm to ensure our robot would hit every square in the 5x5 maze.  At first, DFS seemed like the best choice: it guarantees that the robot would get to every square in a timely manor.  The servos and the sensors were inconsistent enough that it was very difficult to keep track of what square the robot was in to execute DFS.  Based on the constraints for the maze, turning right any time that we could was a viable alternative.  Therefore, the order of priorities for navigation became <code class="language-plaintext highlighter-rouge">turn right</code>, <code class="language-plaintext highlighter-rouge">go straight</code>, <code class="language-plaintext highlighter-rouge">turn left</code>, <code class="language-plaintext highlighter-rouge">turn around</code>.</p>

<div align="center">
    <b>Figure 4: Serial Monitor of Maze Navigation</b>
    <br />
    <img src="/assets/img/3400/lab4_nav.png" style="width: 64%" />
    <p></p>
</div>

<h3 id="the-treasures">The Treasures</h3>

<div align="center">
    <b>Figure 5: The Completed Base Station</b>
    <br />
    <img src="/assets/img/3400/lab4_base1.jpeg" style="width: 64%" />
    <p></p>
</div>

<p>The code and method for detecting treasures is exactly the same as it was in part 2 using analog compare and phototransistors.  However, in part 2 the communication of a detected treasure was done via the serial monitor, whereas in part 4 we must use our base station to display the treasure frequency.  Using the built-in Arduino RF library, we can simply swap out a print statement for an RF statement.  In order to make sure our robot and base station are paired, we set the pipe numbers accordingly.  Our robot sent data on pipe 8 and received acknowledgements from the base station on pipe 9.</p>

<p>On the base station, the <code class="language-plaintext highlighter-rouge">number_to_display</code> to the 7 segment display is no longer a constant, but instead an <code class="language-plaintext highlighter-rouge">unsigned int</code> that is set by the packet (the treasure frequency) received via RF.  When the robot is not detecting treasures the robot is not sending any packets, so the frequency is displayed on the base station until the robot sees another treasure.</p>

<h3 id="the-led">The LED</h3>
<p>When the robot finds two <em>distinct</em> treasures (two treasures whose frequencies are greater than 999 Hz apart), it has finished the maze.  We signify this result by stopping the servos and blinking the on-board LED.  The on-board LED is <code class="language-plaintext highlighter-rouge">D13</code> on the nano, which is also being used for RF.  Once we disable RF, it is possible to use non-blocking statements to write high and low to input D13 every 500 ms to blink the LED at 1 Hz.  We were able to test this using a function generator wired to an LED, as in part 2.</p>

<div align="center">
    <b>Figure 6: Serial Monitor of Treasure Detection and LED Blink</b>
    <br />
    <img src="/assets/img/3400/lab4_treasure.png" style="width: 64%" />
    <p></p>
</div>

<h3 id="the-demo">The Demo</h3>

<div align="center">
    <b>Figure 7: The Robot (Side View)</b>
    <br />
    <img src="/assets/img/3400/lab4_robot2.jpeg" style="width: 64%" />
    <p></p>
</div>

<p>At the demo we demonstrated all of the hard work we had put into the project.  Our robot jumped into action as soon as the appropriate note in ‘happy birthday’ was reached.  Then, although the robot hit 3 walls throughout its journey, the robot navigated to every square of the maze rather quickly.  Carl was so impressed that he took a video of it in action.  It was very rewarding to finally get to the demo after 5 or 6 weeks of hard work on part 4 alone, plus the work done in parts 1, 2, and 3.</p>

<h4 id="video-of-final-demo">Video of Final Demo</h4>
<div align="center">
<iframe width="560" height="315" src="https://www.youtube.com/embed/z3z_sgg2Xtw" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>
<p></p>
</div>

<h3 id="resources">Resources</h3>
<p>[1] C. Poitras, <em>RF Communication, Navigation &amp; Finalizing Robot – Final Demo</em>, ECE 3400, November 1, 2021.</p>

      
    </div>
  </div>
</div>


    <footer>
  <div class="container-md beautiful-jekyll-footer">
    <div class="row">
      <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1">
      <ul class="list-inline text-center footer-links"><li class="list-inline-item">
    <a href="mailto:tyler07039@gmail.com" title="Email me">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">Email me</span>
   </a>
  </li><li class="list-inline-item">
    <a href="https://github.com/tylerbisk" title="GitHub">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fab fa-github fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">GitHub</span>
   </a>
  </li><li class="list-inline-item">
    <a href="https://twitter.com/tylerbisk" title="Twitter">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">Twitter</span>
   </a>
  </li><li class="list-inline-item">
    <a href="https://linkedin.com/in/tylerbisk" title="LinkedIn">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">LinkedIn</span>
   </a>
  </li></ul>

      
      <p class="copyright text-muted">
      
        © Tyler Bisk
        &nbsp;&bull;&nbsp;
      
      2023

      

      
      </p>
      <!-- Add a second line to the footer -->
      <p class="theme-by text-muted">

      </p>
      </div>
    </div>
  </div>
</footer>


    
  
    
  <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>


  
    
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>


  
    
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>


  



  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
      <script src="/assets/js/main.js"></script>
    
  







  </body>
</html>
